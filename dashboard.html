<!doctype html>
<html>
<head>
  <meta charset="utf-8" />
  <title>SQLite Suite Dashboard</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <style>
    :root{
      --bg:#fff9c4;
      --accent:#ffca28;
      --accent-dark:#f57f17;
      --muted:#666;
      --mono: "Courier New", monospace;
    }
    body{ font-family: Inter, Arial, sans-serif; margin:0; padding:20px; background:var(--bg); color:#222; }
    header{ display:flex; align-items:center; gap:12px; }
    h1{ margin:0; font-size:20px; }
    .controls{ margin-top:16px; }
    .btn{ background:var(--accent); border:1px solid var(--accent-dark); padding:10px 14px; border-radius:6px; cursor:pointer; margin-right:8px; }
    .small{ padding:6px 8px; font-size:13px; }
    #out{ margin-top:16px; padding:12px; background:#fff; border-radius:6px; min-height:160px; max-height:420px; overflow:auto; box-shadow:0 1px 3px rgba(0,0,0,0.08);}
    label{ display:inline-block; margin-right:8px; color:var(--muted); }
    input[type=text]{ padding:8px; border:1px solid #ddd; border-radius:4px; width:220px; }
    footer{ position:fixed; right:12px; bottom:10px; opacity:0.16; font-family:var(--mono); font-size:12px; }
    .row{ display:flex; gap:12px; align-items:center; margin-top:12px; }
    .col{ display:flex; flex-direction:column; gap:8px; }
    .card{ background:#fff; padding:12px; border-radius:8px; box-shadow:0 1px 4px rgba(0,0,0,0.06); }
    .danger{ background:#ffebee; border:1px solid #ffcdd2; }
  </style>
</head>
<body>
  <header>
    <img src="" alt="icon" width="44" height="44" style="background:#ffeb3b;border-radius:10px;padding:6px;" />
    <div>
      <h1>SQLite Automation Suite</h1>
      <div style="color:var(--muted); font-size:13px;">Backup ¬∑ Restore ¬∑ Replay ¬∑ Alerts ¬∑ Audit</div>
    </div>
  </header>

  <section class="controls">
    <div class="row">
      <button class="btn" onclick="backupNow()">üîÑ Backup Now</button>
      <button class="btn" onclick="restorePrompt()">‚ôªÔ∏è Restore</button>
      <button class="btn" onclick="openReplay()">üîÅ Replay</button>
      <button class="btn" onclick="loadAlerts()">üö® Alerts</button>
      <button class="btn small" onclick="downloadAudit()">üìú Audit Log</button>
    </div>

    <div class="row" style="margin-top:12px;">
      <div class="card col" style="width:360px;">
        <label>Config file</label>
        <div style="display:flex; gap:8px;">
          <input type="text" id="cfgPath" value="db_config.json" />
          <button class="btn small" onclick="loadConfig()">Load</button>
        </div>
        <pre id="cfgOut" style="margin:0; background:#f7f7f7; padding:8px; border-radius:6px; font-size:13px; max-height:120px; overflow:auto;"></pre>
      </div>

      <div class="card col" style="flex:1;">
        <label>Quick actions</label>
        <div style="display:flex; gap:8px; flex-wrap:wrap;">
          <button class="btn small" onclick="seedSample()">Seed Sample DB</button>
          <button class="btn small" onclick="openBackupFolder()">Open Backups</button>
          <button class="btn small" onclick="clearOut()">Clear Output</button>
        </div>
        <div style="margin-top:8px; color:var(--muted); font-size:13px;">Use these during local testing only. Do not run destructive actions on production without checking config.</div>
      </div>
    </div>
  </section>

  <pre id="out" class="card" aria-live="polite">Ready.</pre>

  <footer>WAP-MHA-YEA-MATT ‚Äî ‡∏£‡∏±‡∏ô‡πÄ‡∏ß‡πá‡∏ö‡πÑ‡∏´‡∏ô ‡∏ö‡∏£‡∏£‡∏•‡∏±‡∏¢‡πÄ‡∏ß‡πá‡∏ö‡∏ô‡∏±‡πâ‡∏ô!!</footer>

  <script>
    async function callApi(path, method='GET', body=null){
      const opts = { method, headers:{'Content-Type':'application/json'} };
      if(body) opts.body = JSON.stringify(body);
      try{
        const res = await fetch(path, opts);
        const j = await res.json();
        showOut(j);
        return j;
      }catch(e){
        showOut({ error: String(e) });
        return null;
      }
    }

    function showOut(obj){
      const el = document.getElementById('out');
      el.textContent = JSON.stringify(obj, null, 2);
    }

    async function backupNow(){
      showOut({ status: "starting backup..." });
      const r = await callApi('/api/backup','POST');
      if(r) showOut(r);
    }

    async function restorePrompt(){
      const path = prompt("Enter backup file path to restore (relative):","backups/");
      if(!path) return;
      showOut({ status:"restoring", path });
      const r = await callApi('/api/restore','POST', { path });
      if(r) showOut(r);
    }

    function openReplay(){
      const batch = prompt("Enter batch_id to replay","batch-1");
      if(!batch) return;
      callApi('/api/replay/'+encodeURIComponent(batch));
    }

    function loadAlerts(){ callApi('/api/alerts'); }

    function loadConfig(){
      const p = document.getElementById('cfgPath').value || 'db_config.json';
      fetch('/ui/'+p).then(r => {
        if(!r.ok) return fetch('/'+p);
        return r;
      }).then(r => r && r.text()).then(t=>{
        document.getElementById('cfgOut').textContent = t || 'Not found';
      }).catch(e=>{
        document.getElementById('cfgOut').textContent = 'Error loading config';
      });
    }

    function seedSample(){
      fetch('/api/seed',{ method:'POST' }).then(r=>r.json()).then(j=>showOut(j)).catch(e=>showOut({error:String(e)}));
    }

    function downloadAudit(){
      fetch('/api/audit').then(r=>r.text()).then(txt=>{
        const blob = new Blob([txt],{type:'text/plain'});
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url; a.download='audit.log'; document.body.appendChild(a); a.click(); a.remove(); URL.revokeObjectURL(url);
      }).catch(e=>showOut({error:String(e)}));
    }

    function openBackupFolder(){
      showOut({ info: "Open the backups folder on the host. On packaged builds this may be relative to app folder." });
    }

    function clearOut(){ showOut('Ready.'); }

    // load config preview on start
    window.addEventListener('load', loadConfig);
  </script>
</body>
</html>
